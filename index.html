<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leaving Cert Spanish - Oral AI Practice</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #2563eb; --bg: #f1f5f9; --text-main: #1e293b; --radius: 16px; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-main); padding: 20px; line-height: 1.5; }
    .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: var(--radius); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: var(--primary); margin-bottom: 5px; }
    .subtitle { text-align: center; color: #64748b; font-size: 0.9rem; margin-bottom: 25px; }
    .topic-selector { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 20px; }
    .topic-btn { flex: 0 0 auto; padding: 8px 16px; background: #e2e8f0; border: none; border-radius: 20px; font-weight: 600; cursor: pointer; color: #475569; }
    .topic-btn.active { background: var(--primary); color: white; }
    .question-box { background: #eff6ff; border: 2px solid #dbeafe; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; font-size: 1.1rem; font-weight: 600; color: #1e3a8a; }
    textarea { width: 100%; border: 2px solid #cbd5e1; border-radius: 12px; padding: 15px; font-size: 1rem; min-height: 120px; box-sizing: border-box; font-family: inherit; margin-bottom: 15px; }
    textarea:focus { outline: none; border-color: var(--primary); }
    .btn-analyze { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: transform 0.1s; }
    .btn-analyze:active { transform: scale(0.98); }
    .btn-analyze:disabled { opacity: 0.7; cursor: wait; }
    #resultArea { margin-top: 25px; padding-top: 20px; border-top: 2px dashed #e2e8f0; display: none; }
    .score-badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: 800; font-size: 0.9rem; margin-bottom: 10px; }
    .score-high { background: #dcfce7; color: #166534; }
    .score-mid { background: #fef9c3; color: #854d0e; }
    .score-low { background: #fee2e2; color: #991b1b; }
    li { margin-bottom: 8px; }
  </style>
</head>

<body>
<div class="container">
  <h1>üá™üá∏ Pr√°ctica Oral LC</h1>
  <div class="subtitle">AI Feedback for Leaving Certificate Students</div>
  <div class="topic-selector" id="topicList"></div>
  <div class="question-box" id="qDisplay">üëã Selecciona un tema arriba para empezar</div>
  <textarea id="userInput" placeholder="1. Pulsa el micr√≥fono de tu teclado.&#10;2. Dicta tu respuesta en espa√±ol..."></textarea>
  <button class="btn-analyze" id="btnAction" onclick="analyze()" disabled>‚ú® Evaluar mi respuesta</button>
  <div id="status" style="text-align: center; margin-top: 10px; color: #64748b; font-size: 0.9rem;"></div>
  
  <div id="resultArea">
    <div id="scoreBadge" class="score-badge"></div>
    <div id="feedbackText"></div>
    <ul id="errorsList" style="padding-left: 20px; color: #475569;"></ul>
  </div>
</div>

<script>
// ===============================================
// üëá PEGA AQU√ç TU CLAVE (la que empieza por AIza)
// ===============================================
const API_KEY = "AIzaSyDpFm2h1um1-UecmrUlzlPoGyg-W3tx38Q"; 

const TOPICS = [
  { id: "1A", title: "Sobre M√≠", q: "¬øC√≥mo te llamas, cu√°ntos a√±os tienes y cu√°ndo es tu cumplea√±os?" },
  { id: "2A", title: "Familia", q: "H√°blame de tu familia. ¬øCu√°ntos sois y c√≥mo te llevas con ellos?" },
  { id: "3A", title: "Casa", q: "¬øC√≥mo es tu casa y cu√°l es tu habitaci√≥n favorita?" },
  { id: "4A", title: "Mi Barrio", q: "¬øC√≥mo es tu barrio? ¬øHay mucho que hacer para los j√≥venes?" },
  { id: "5A", title: "Colegio", q: "¬øQu√© asignaturas estudias y cu√°l es tu favorita? ¬øPor qu√©?" },
  { id: "7A", title: "Hobbies", q: "¬øQu√© haces en tu tiempo libre? ¬øTe gusta el deporte?" },
  { id: "8A", title: "Pasado", q: "¬øQu√© hiciste el fin de semana pasado? (Usa pret√©ritos)" },
  { id: "9A", title: "Vacaciones", q: "¬øAd√≥nde fuiste de vacaciones el a√±o pasado? ¬øTe gust√≥?" },
  { id: "10A", title: "Futuro", q: "¬øQu√© planes tienes para el a√±o que viene despu√©s de los ex√°menes?" }
];

let currentTopic = null;

const list = document.getElementById("topicList");
TOPICS.forEach(t => {
  const btn = document.createElement("button");
  btn.className = "topic-btn";
  btn.innerText = t.id + " " + t.title;
  btn.onclick = () => setTopic(t, btn);
  list.appendChild(btn);
});

function setTopic(t, btn) {
  currentTopic = t;
  document.querySelectorAll(".topic-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  document.getElementById("qDisplay").innerText = t.q;
  document.getElementById("btnAction").disabled = false;
  document.getElementById("resultArea").style.display = "none";
}

async function analyze() {
  const text = document.getElementById("userInput").value;
  if(text.length < 5) return alert("Respuesta muy corta. Int√©ntalo de nuevo.");

  const btn = document.getElementById("btnAction");
  btn.disabled = true;
  btn.innerText = "‚è≥ El examinador est√° pensando...";
  document.getElementById("status").innerText = "Conectando con Google AI...";

  const prompt = `
    Eres un examinador del Leaving Cert de espa√±ol.
    Pregunta: "${currentTopic.q}"
    Respuesta del alumno: "${text}"
    Eval√∫a estrictamente gram√°tica y vocabulario.
    Responde SOLO con este JSON puro (sin bloques de c√≥digo):
    {
      "nota": (0-100),
      "comentario": "Breve feedback motivador",
      "errores": ["Error -> Correcci√≥n", "Error -> Correcci√≥n"]
    }
  `;

  try {
    // üëá HEMOS PUESTO EL MODELO QUE VIMOS EN TU LISTA üëá
    let model = "gemini-flash-latest"; 
    
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    });

    const data = await response.json();

    if (data.error) {
       throw new Error("Error de Google: " + data.error.message);
    }

    if (!data.candidates || !data.candidates[0].content) {
       throw new Error("Google no devolvi√≥ texto. Int√©ntalo de nuevo.");
    }

    const rawText = data.candidates[0].content.parts[0].text;
    const cleanJson = rawText.replace(/```json/g, "").replace(/```/g, "").trim();
    
    let result;
    try {
        result = JSON.parse(cleanJson);
    } catch (parseError) {
        throw new Error("La IA respondi√≥ pero no en formato correcto. Prueba otra vez.");
    }
    
    renderResult(result);

  } catch (e) {
    alert("‚ùå Algo fall√≥: " + e.message);
  } finally {
    btn.disabled = false;
    btn.innerText = "‚ú® Evaluar mi respuesta";
    document.getElementById("status").innerText = "";
  }
}

function renderResult(data) {
  const area = document.getElementById("resultArea");
  area.style.display = "block";
  
  const badge = document.getElementById("scoreBadge");
  badge.innerText = `Nota estimada: ${data.nota}%`;
  badge.className = "score-badge " + (data.nota >= 70 ? "score-high" : data.nota >= 40 ? "score-mid" : "score-low");

  document.getElementById("feedbackText").innerHTML = `<strong>Feedback:</strong> ${data.comentario}`;
  
  const ul = document.getElementById("errorsList");
  ul.innerHTML = "";
  if(!data.errores || data.errores.length === 0) {
    ul.innerHTML = "<li>‚úÖ ¬°Sin errores graves detectados!</li>";
  } else {
    data.errores.forEach(err => {
      const li = document.createElement("li");
      li.innerText = "‚ö†Ô∏è " + err;
      ul.appendChild(li);
    });
  }
}
</script>
</body>
</html>
